<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quiz Processor (Auto-Save)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<style>
/* --- BASE STYLES --- */
:root { --bg:#f5f7fb; --card:#ffffff; --muted:#6b7280; --accent:#0f62fe; --success:#10b981; --danger:#ef4444; --soft-green-bg: #d1fae5; --soft-green-text: #065f46; }
* { box-sizing:border-box }
body { font-family:Inter,system-ui,Segoe UI,Roboto,Arial; line-height:1.5; margin:0; background:linear-gradient(180deg,var(--bg),#eef3fb); color:#0f172a }
.wrap { max-width:1100px; margin:24px auto; padding:18px }
header { display:flex; gap:12px; align-items:center; margin-bottom:12px }
h1 { font-size:18px; margin:0 }
p.lead { margin:0; color:var(--muted); font-size:13px }

/* --- GRID LAYOUT --- */
.grid { display:grid; grid-template-columns:1fr 360px; gap:16px; width: 100%; display: flex; flex-direction: column; }
@media(max-width:980px) { .grid { grid-template-columns:1fr } .right-col { order:2 } }
.card { background:var(--card); border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(12,20,40,0.06); width:100%; flex:1 }

/* --- CONTROLS & INPUTS --- */
label { display:block; font-weight:600; margin-bottom:6px; font-size:13px }
#pasteArea { height:300px; border:2px dashed #dbe6fb; border-radius:8px; padding:12px; overflow:auto }
#pasteArea:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 4px rgba(15,98,254,0.08) }
#pasteArea img { max-width: 100% !important; max-height: 200px !important; height: auto !important; object-fit: contain; display: block; margin: 8px auto; }
.controls { display:flex; gap:8px; flex-wrap:wrap }
button { cursor:pointer; border:0; padding:8px 12px; border-radius:8px; background:var(--accent); color:white; font-weight:600 }
button.ghost { background:transparent; color:var(--accent); border:1px solid rgba(15,98,254,0.12) }
button.warn { background:var(--danger) }
.small { font-size:13px }
textarea#answers { width:100%; height:80px; padding:8px; border-radius:8px; border:1px solid #e6eefc }
.meta { display:flex; gap:8px; align-items:center; flex-wrap:wrap }
pre#jsonOut { background:#0b1220; color:#dbeafe; padding:12px; border-radius:8px; overflow:auto; max-height:260px }

/* --- QUIZ AREA STYLES (ƒê√É FIX TR√ÄN D√íNG) --- */
.quiz-area { min-height:200px }
.question-card { 
    padding:30px 14px 14px 14px; /* TƒÉng padding top ƒë·ªÉ n√© n√∫t Tho√°t */
    border-radius:10px; 
    border:1px solid #eef3fb; 
    background:linear-gradient(180deg,#fff,#fbfdff);
    position: relative; /* ƒê·ªÉ ƒë·ªãnh v·ªã n√∫t Tho√°t */
    
    /* FIX L·ªñI TR√ÄN D√íNG ·ªû ƒê√ÇY */
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-word;
    white-space: pre-wrap; 
    max-width: 100%;
}
.question-card img, .choice img { max-width:100%; height:auto; border-radius:6px; display:block; margin:6px 0 }

.choices { display:flex; flex-direction:column; gap:6px; margin-top:10px }
.choice { 
    padding:10px; border-radius:8px; border:1px solid #e6eefc; cursor:pointer; display: flex; align-items: flex-start; gap: 8px;
    
    /* FIX L·ªñI TR√ÄN D√íNG TRONG ƒê√ÅP √ÅN */
    word-wrap: break-word; 
    overflow-wrap: break-word; 
    word-break: break-word;
}
.choice strong { min-width: 20px; } 
.choice.correct { outline:3px solid rgba(16,185,129,0.18); border-color:var(--success); background: #ecfdf5; }
.choice.wrong { outline:3px solid rgba(239,68,68,0.12); border-color:var(--danger); background: #fef2f2; }
.choice.selected { background-color: rgba(15, 98, 254, 0.1); border-color: var(--accent); }

/* --- N√öT THO√ÅT (M·ªöI) --- */
#exitBtnOnCard {
    position: absolute;
    top: 8px;
    right: 8px;
    background-color: var(--soft-green-bg);
    color: var(--soft-green-text);
    border: 1px solid #6ee7b7;
    font-size: 11px;
    padding: 4px 12px;
    border-radius: 20px;
    font-weight: 600;
    transition: all 0.2s;
    z-index: 10;
}
#exitBtnOnCard:hover {
    background-color: #a7f3d0;
    transform: scale(1.05);
}

/* --- FULLSCREEN QUIZ MODE --- */
.fullscreen-quiz .grid { grid-template-columns: 1fr !important; }
.fullscreen-quiz .grid > :not(.right-col) { display: none; }
.fullscreen-quiz .right-col { order: 1; width: 100%; }
.fullscreen-quiz .right-col .card { height: fit-content; min-height: 90vh; display: flex; flex-direction: column; }
.fullscreen-quiz .quiz-area { flex: 1; overflow-y: auto; }
.right-col { display: none; }

/* --- RESULT SUMMARY --- */
.result-summary { padding:12px; display:flex; flex-direction:column; gap:12px; max-height: 80vh; overflow-y: auto; }
.result-stats { display:flex; gap:16px; font-size:14px; }
.result-stats .correct-count { color:#10b981; font-weight:600; }
.result-stats .wrong-count { color:#ef4444; font-weight:600; }
.result-item { padding:8px; margin-bottom:4px; border-radius:6px; font-size:13px; line-height:1.4; border: 1px solid #eee; }
.result-item.correct { background:rgba(16,185,129,0.1); border-left:3px solid #10b981; }
.result-item.wrong { background:rgba(239,68,68,0.1); border-left:3px solid #ef4444; }
.result-actions { display:flex; gap:8px; margin-top:6px; flex-wrap: wrap; }

input[type=file] { display:none }
.footer-note { font-size:13px; color:var(--muted); margin-top:8px }
</style>
</head>
<body>
<div class="wrap">
<header>
<div>
<h1>Quiz Processor (Auto-Save & Mobile Friendly)</h1>
<p class="lead">D·ªØ li·ªáu t·ª± ƒë·ªông l∆∞u. Giao di·ªán t·ªëi ∆∞u cho ƒëi·ªán tho·∫°i.</p>
</div>
</header>
<div class="grid">
  <div>
    <div class="card">
      <label>N·ªôi dung (paste h·ªó tr·ª£ vƒÉn b·∫£n + h√¨nh ·∫£nh)</label>
      <div id="pasteArea" contenteditable="true" spellcheck="false" aria-label="Khu v·ª±c d√°n vƒÉn b·∫£n v√† h√¨nh ·∫£nh">Nh·∫≠p ho·∫∑c d√°n (Ctrl+V) n·ªôi dung v√†o ƒë√¢y.</div>
      <div style="height:10px"></div>
      <div class="meta">
        <div class="controls">
          <label class="ghost" style="display:inline-flex;align-items:center;gap:8px;cursor:pointer;padding:6px 10px;border-radius:8px;border:1px dashed rgba(15,98,254,0.12)">
            <input id="fileInput" type="file" accept=".doc,.docx,text/*,application/*,image/*,.html,.htm,.md,.json" />
            <span style="color:var(--accent);font-weight:700">Ch·ªçn file</span>
          </label>
          <button id="processBtn">X·ª≠ l√Ω ‚Üí JSON</button>
          <button class="ghost" id="previewJSONBtn">Xem JSON</button>
          <button id="startQuizBtn">L√†m b√†i</button>
          <button id="shareQuizBtn" class="ghost">Chia s·∫ª</button>
          <button id="clearDataBtn" class="warn small">X√≥a d·ªØ li·ªáu l∆∞u</button>
          <div style="display:flex;gap:12px;align-items:center;margin-top:6px;width:100%">
            <label><input type="checkbox" id="shuffleQuestions"> Tr·ªôn c√¢u h·ªèi</label>
            <label><input type="checkbox" id="shuffleChoices"> Tr·ªôn ƒë√°p √°n</label>
          </div>
          <label style="display:inline-flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="autoDetectCorrect" checked/>
            <span>T·ª± nh·∫≠n di·ªán ƒë√°p √°n ƒë√∫ng (b·∫Øt ƒë·∫ßu b·∫±ng **)</span>
          </label>
        </div>
      </div>
      <div style="height:12px"></div>
      <label>Danh s√°ch ƒë√°p √°n (n·∫øu kh√¥ng d√πng **)</label>
      <textarea id="answers" placeholder="Nh·∫≠p danh s√°ch ƒë√°p √°n ·ªü d·∫°ng: 1a,2b,3c,...">1a,2a,3a,4a,5a</textarea>
      <div id="jsonSection" style="display:none; margin-top:14px">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="validateBtn" class="ghost">Ki·ªÉm tra nh·∫≠n di·ªán</button>
          <button id="downloadJsonBtn">T·∫£i JSON</button>
        </div>
        <div style="height:12px"></div>
        <pre id="jsonOut">Ch∆∞a x·ª≠ l√Ω</pre>
      </div>
    </div>
    <div style="height:14px"></div>
    <div class="card">
      <label>Log / Th√¥ng b√°o</label>
      <div id="log" style="min-height:40px;color:var(--muted);font-size:13px">S·∫µn s√†ng.</div>
    </div>
  </div>
  <div class="right-col">
    <div class="card">
      <label>Preview / Quiz</label>
      <div id="preview" class="quiz-area">
        <div style="color:var(--muted);font-size:13px">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>
      </div>
      <div style="height:12px"></div>
      <div style="display:flex;justify-content:center;">
        <div class="status" id="quizStatus" style="font-weight:bold; color:var(--accent)">0/0</div>
      </div>
      <div style="height:10px"></div>
    </div>
  </div>
</div>
</div>

<script>
const el = (s) => document.querySelector(s);
const pasteArea = el('#pasteArea');
const fileInput = el('#fileInput');
const processBtn = el('#processBtn');
const jsonOut = el('#jsonOut');
const answersInput = el('#answers');
const logEl = el('#log');
const preview = el('#preview');
const startQuizBtn = el('#startQuizBtn');
const downloadJsonBtn = el('#downloadJsonBtn');
const validateBtn = el('#validateBtn');
const previewJSONBtn = el('#previewJSONBtn');
const quizStatus = el('#quizStatus');
const shareQuizBtn = el('#shareQuizBtn');
const jsonSection = el('#jsonSection');
const clearDataBtn = el('#clearDataBtn');

let isProcessing = false;
let parsed = [];
let currentIndex = 0;
let userAnswers = {};
let autoAdvanceMs = 900;
let originalParsed = null;
const STORAGE_KEY = 'quiz_pro_state';

// --- QU·∫¢N L√ù TR·∫†NG TH√ÅI (Auto-Save) ---
function saveState() {
    try {
        const state = {
            parsed,
            originalParsed,
            currentIndex,
            userAnswers,
            isQuizActive: document.body.classList.contains('fullscreen-quiz'),
            timestamp: Date.now()
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) { console.error('L·ªói l∆∞u:', e); }
}

function restoreState() {
    try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;
        const state = JSON.parse(saved);
        if (state.parsed && state.parsed.length > 0) {
            parsed = state.parsed;
            originalParsed = state.originalParsed || JSON.parse(JSON.stringify(parsed));
            currentIndex = state.currentIndex || 0;
            userAnswers = state.userAnswers || {};
            log('‚ôªÔ∏è ƒê√£ kh√¥i ph·ª•c b√†i l√†m c≈©.');
            if (state.isQuizActive) {
                document.querySelector('.right-col').style.display = 'block';
                document.body.classList.add('fullscreen-quiz');
                if (currentIndex >= parsed.length) showSummary();
                else renderQuestion(currentIndex);
            } else {
                 jsonOut.textContent = JSON.stringify(parsed, null, 2);
            }
        }
    } catch (e) { localStorage.removeItem(STORAGE_KEY); }
}
function clearState() { localStorage.removeItem(STORAGE_KEY); location.reload(); }
clearDataBtn.addEventListener('click', () => { if(confirm('X√≥a to√†n b·ªô d·ªØ li·ªáu l∆∞u?')) clearState(); });

// --- C√ÅC H√ÄM TI·ªÜN √çCH ---
function log(msg) { logEl.textContent = msg; }
function shuffleArray(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
function stripHtml(html) {
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;
    let cleanedText = Array.from(tempDiv.childNodes)
        .filter(node => ['P', 'BR'].includes(node.nodeName) || node.nodeType === 3)
        .map(node => node.nodeType === 3 ? node.textContent : node.outerHTML)
        .join('')
        .replace(/<br\s*\/?>/g, '')
        .replace(/&nbsp;/g, ' ').trim();
    return cleanedText.replace(/<p[^>]*>\s*(<span[^>]*>)?\s*(<\/span>)?\s*<\/p>/g, '');
}

// --- FILE & PASTE ---
fileInput.addEventListener('change', async (e) => {
    const f = e.target.files[0];
    if (!f) return;
    if (f.type.startsWith('image/')) {
        const data = await fileToDataURL(f);
        pasteArea.innerHTML = `<img src="${data}" />` + pasteArea.innerHTML;
        return;
    }
    if (f.name.endsWith('.docx')) {
        const reader = new FileReader();
        reader.onload = (evt) => {
            mammoth.convertToHtml({ arrayBuffer: evt.target.result })
                .then(r => { pasteArea.innerHTML = stripHtml(r.value); log('ƒê√£ ƒë·ªçc Word.'); })
                .catch(err => log('L·ªói Word: ' + err.message));
        };
        reader.readAsArrayBuffer(f);
        return;
    }
    const fr = new FileReader();
    fr.onload = () => { pasteArea.innerHTML = stripHtml(fr.result); log('ƒê√£ ƒë·ªçc file.'); };
    fr.readAsText(f);
});

pasteArea.addEventListener('paste', async (e) => {
    const items = e.clipboardData && e.clipboardData.items;
    if (!items) return;
    for (const it of items) {
        if (it.type.startsWith('image/')) {
            const file = it.getAsFile();
            const data = await fileToDataURL(file);
            insertHTMLAtCursor(`<img src="${data}" />`);
            e.preventDefault();
        } else if (it.type.startsWith('text/')) {
            e.preventDefault();
            const text = await navigator.clipboard.readText();
            insertHTMLAtCursor(text); 
        }
    }
});
function fileToDataURL(file) { return new Promise((res, rej) => { const fr = new FileReader(); fr.onload = () => res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); }); }
function insertHTMLAtCursor(html) {
    const sel = window.getSelection();
    if (!sel.rangeCount) return pasteArea.insertAdjacentHTML('beforeend', html);
    const range = sel.getRangeAt(0);
    range.deleteContents();
    range.insertNode(range.createContextualFragment(html));
}

// --- PARSE ---
function parseContent(rawHtml) {
    let cleaned = rawHtml.replace(/<o:p>.*?<\/o:p>/g, '').replace(/<br\s*\/?>/g, '\n');
    const div = document.createElement('div');
    div.innerHTML = cleaned;
    let lines = [];
    div.childNodes.forEach(n => {
        if (n.nodeName === 'P' || n.nodeName === 'DIV') lines.push(n.innerHTML.trim());
        else if (n.nodeType === 3 && n.textContent.trim()) lines.push(n.textContent.trim());
    });
    const items = [];
    let current = null;
    const choiceRegex = /^\s*(\*{1,2}\s*)?([A-Da-d])\s*[\.:]\s+/;
    const idRegex = /ID:\s*(\d+)/i;
    for (let ln of lines) {
        const txt = ln.replace(/<[^>]+>/g, '').trim();
        if (!txt) continue;
        const idMatch = txt.match(idRegex);
        if (idMatch) {
            if (current) items.push(current);
            current = { rawId: idMatch[1], question: '', choices: [] };
            continue;
        }
        if (!current && !idMatch) current = { question: '', choices: [] };
        const choiceMatch = txt.match(choiceRegex);
        if (choiceMatch) {
            const key = choiceMatch[2].toLowerCase();
            const content = ln.replace(/<[^>]+>/g, '').replace(choiceRegex, '').trim(); 
            current.choices.push({ key, text: content }); 
        } else {
            current.question += (current.question ? '<br>' : '') + ln;
        }
    }
    if (current) items.push(current);
    return items.map((it, i) => ({ id: i + 1, question: it.question, choices: it.choices }));
}

processBtn.addEventListener('click', () => {
    parsed = parseContent(pasteArea.innerHTML);
    originalParsed = JSON.parse(JSON.stringify(parsed));
    const autoDetect = document.getElementById('autoDetectCorrect').checked;
    if (autoDetect) {
        parsed.forEach(q => {
            const correct = q.choices.filter(c => c.text.includes('**'));
            q.correct = correct.length ? correct.map(c => c.key) : [];
            q.multiple = correct.length > 1;
            q.choices.forEach(c => c.text = c.text.replace(/\*\*/g, '').trim());
        });
    } else {
        const map = parseAnswers(answersInput.value);
        parsed.forEach((q, i) => { q.correct = map[i] ? [map[i]] : []; q.multiple = false; });
    }
    jsonOut.textContent = JSON.stringify(parsed, null, 2);
    log(`X·ª≠ l√Ω xong ${parsed.length} c√¢u.`);
    saveState();
});

function parseAnswers(txt) {
    const map = [];
    txt.split(/[,;\s]+/).forEach(p => {
        const m = p.match(/(\d+)([a-d])/i);
        if (m) map[parseInt(m[1])-1] = m[2].toLowerCase();
    });
    return map;
}

// --- QUIZ LOGIC ---
startQuizBtn.addEventListener('click', () => {
    if (!parsed.length) processBtn.click();
    let temp = JSON.parse(JSON.stringify(parsed));
    if (el('#shuffleChoices').checked) temp.forEach(q => q.choices = shuffleArray(q.choices));
    if (el('#shuffleQuestions').checked) temp = shuffleArray(temp);
    parsed = temp;
    currentIndex = 0;
    userAnswers = {};
    document.querySelector('.right-col').style.display = 'block';
    document.body.classList.add('fullscreen-quiz');
    renderQuestion(0);
    saveState();
});

// --- CH·ª®C NƒÇNG THO√ÅT V·ªÄ TRANG CH·ª¶ (Y√äU C·∫¶U M·ªöI) ---
function confirmExit() {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën tho√°t ra trang ch·ªß ƒë·ªÉ t·∫°o b√†i m·ªõi kh√¥ng? Ti·∫øn ƒë·ªô hi·ªán t·∫°i s·∫Ω b·ªã x√≥a.')) {
        // X√≥a d·ªØ li·ªáu l∆∞u
        localStorage.removeItem(STORAGE_KEY);
        // Reset giao di·ªán v·ªÅ ban ƒë·∫ßu
        document.body.classList.remove('fullscreen-quiz');
        el('.right-col').style.display = 'none';
        preview.innerHTML = '<div style="color:var(--muted);font-size:13px">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>';
        // Reset bi·∫øn n·ªôi b·ªô
        parsed = [];
        currentIndex = 0;
        userAnswers = {};
        quizStatus.textContent = "0/0";
        log('ƒê√£ tho√°t v·ªÅ trang ch·ªß. B·∫°n c√≥ th·ªÉ nh·∫≠p n·ªôi dung m·ªõi.');
    }
}

function renderQuestion(i) {
    if (!parsed[i]) return showSummary();
    const p = parsed[i];
    quizStatus.textContent = `${i + 1}/${parsed.length}`;
    const uAns = userAnswers[i + 'selected'] || [];
    const isDone = userAnswers.hasOwnProperty(i);
    const choicesHtml = p.choices.map(c => {
        let cls = 'choice';
        if (uAns.includes(c.key) && !isDone) cls += ' selected';
        if (isDone) {
            if (p.correct.includes(c.key)) cls += ' correct';
            if (uAns.includes(c.key) && !p.correct.includes(c.key)) cls += ' wrong';
        }
        return `<div class="${cls}" data-key="${c.key}">
            <strong>${c.key.toUpperCase()}.</strong> <span>${c.text}</span>
        </div>`;
    }).join('');

    preview.innerHTML = `
        <div class="question-card">
            <button id="exitBtnOnCard" onclick="confirmExit()">‚åÇ Tho√°t</button>
            <div><strong>C√¢u ${i + 1}:</strong> ${p.question}</div>
            ${p.multiple ? '<div style="color:#f59e0b;font-size:12px">üìå Ch·ªçn nhi·ªÅu ƒë√°p √°n</div>' : ''}
            <div class="choices">${choicesHtml}</div>
        </div>`;
    document.querySelectorAll('.choice').forEach(ch => {
        ch.addEventListener('click', () => handleSelect(ch));
    });
}

function handleSelect(el) {
    if (isProcessing || userAnswers.hasOwnProperty(currentIndex)) return;
    const key = el.dataset.key;
    const idx = currentIndex;
    const q = parsed[idx];
    if (!userAnswers[idx+'selected']) userAnswers[idx+'selected'] = [];
    const sel = userAnswers[idx+'selected'];
    if (q.multiple) {
        if (sel.includes(key)) {
            sel.splice(sel.indexOf(key), 1);
            el.classList.remove('selected');
        } else {
            sel.push(key);
            el.classList.add('selected');
        }
        if (sel.length === q.correct.length) finishQuestion(idx, sel, q.correct);
        else saveState(); 
    } else {
        userAnswers[idx+'selected'] = [key];
        el.parentElement.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        finishQuestion(idx, [key], q.correct);
    }
}

function finishQuestion(idx, selected, correct) {
    isProcessing = true;
    const isCorrect = selected.length === correct.length && selected.every(k => correct.includes(k));
    userAnswers[idx] = isCorrect;
    document.querySelectorAll('.choice').forEach(c => {
        const k = c.dataset.key;
        if (correct.includes(k)) c.classList.add('correct');
        else if (selected.includes(k)) c.classList.add('wrong');
    });
    saveState();
    setTimeout(() => {
        isProcessing = false;
        currentIndex++;
        if (currentIndex < parsed.length) renderQuestion(currentIndex);
        else showSummary();
        saveState();
    }, autoAdvanceMs);
}

function showSummary() {
    let correct = 0, wrong = 0;
    const list = parsed.map((q, i) => {
        if (userAnswers[i]) { correct++; return ''; }
        wrong++;
        return `<div class="result-item wrong">
            <strong>C√¢u ${i+1}:</strong> ${q.question}<br>
            <span style="color:red">Ch·ªçn: ${(userAnswers[i+'selected']||[]).join(', ').toUpperCase()}</span> - 
            <span style="color:green">ƒê√∫ng: ${q.correct.join(', ').toUpperCase()}</span>
        </div>`;
    }).join('');
    
    preview.innerHTML = `
        <div class="result-summary">
            <h3 style="margin:0">K·∫øt qu·∫£</h3>
            <div class="result-stats">
                <span class="correct-count">ƒê√∫ng: ${correct}</span>
                <span class="wrong-count">Sai: ${wrong}</span>
            </div>
            ${wrong > 0 ? `<div style="margin-top:10px"><h4>Xem l·∫°i c√¢u sai:</h4>${list}</div>` : '<p>Ch√∫c m·ª´ng! B·∫°n l√†m ƒë√∫ng h·∫øt!</p>'}
            <div class="result-actions">
                <button onclick="confirmExit()" class="ghost">‚åÇ V·ªÅ trang ch·ªß</button>
            </div>
        </div>`;
}

window.addEventListener('load', () => restoreState());
shareQuizBtn.addEventListener('click', () => {
    if (!parsed.length) return alert('Ch∆∞a c√≥ d·ªØ li·ªáu');
    const d = btoa(unescape(encodeURIComponent(JSON.stringify(parsed))));
    const url = `${location.origin}${location.pathname}?d=${d}`;
    navigator.clipboard.writeText(url).then(() => log('ƒê√£ copy link!')).catch(()=>prompt('Copy link:', url));
});
const p = new URLSearchParams(location.search);
if (p.get('d')) {
    try {
        parsed = JSON.parse(decodeURIComponent(escape(atob(p.get('d')))));
        originalParsed = JSON.parse(JSON.stringify(parsed));
        document.querySelector('.right-col').style.display = 'block';
        document.body.classList.add('fullscreen-quiz');
        renderQuestion(0);
    } catch(e) { console.error(e); }
}
</script>
</body>
</html>
